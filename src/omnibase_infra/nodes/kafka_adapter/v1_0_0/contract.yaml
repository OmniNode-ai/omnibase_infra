# Infrastructure Kafka Adapter - ONEX Contract
# Effect node for Kafka message streaming operations via message bus integration

# === REQUIRED ROOT FIELDS ===
contract_version: {major: 1, minor: 0, patch: 0}
node_name: "kafka_adapter"
node_version: {major: 1, minor: 0, patch: 0}
contract_name: "kafka_adapter_contract"
description: "Infrastructure Kafka Adapter - Message Bus to Kafka Streaming Bridge"
node_type: "EFFECT"
name: "kafka_adapter"
version: {major: 1, minor: 0, patch: 0}
input_model: "ModelKafkaAdapterInput"
output_model: "ModelKafkaAdapterOutput"

# === NODE SPECIFICATION ===
node_specification:
  node_name: "kafka_adapter"
  version: {major: 1, minor: 0, patch: 0}
  description: "Infrastructure Kafka Adapter - Message Bus to Kafka Streaming Bridge"
  main_node_class: "Node"
  container_injection: "ONEXContainer"
  business_logic_pattern: "effect"

# === DEPENDENCIES ===
dependencies:
  - name: "protocol_kafka_client"
    type: "protocol"
    class_name: "ProtocolKafkaClient"
    module: "omnibase_core.protocol.protocol_kafka_client"
  - name: "protocol_event_bus"
    type: "protocol"
    class_name: "ProtocolEventBus"
    module: "omnibase_core.protocol.protocol_event_bus"
  - name: "protocol_message_broker"
    type: "protocol"
    class_name: "ProtocolMessageBroker"
    module: "omnibase_core.protocol.protocol_message_broker"

# === SHARED MODEL DEPENDENCIES ===
shared_model_dependencies:
  - name: "model_kafka_message"
    type: "model"
    class_name: "ModelKafkaMessage"
    module: "omnibase_infra.models.kafka.model_kafka_message"
    description: "Shared Kafka message model"
  
  - name: "model_kafka_topic_config"
    type: "model"
    class_name: "ModelKafkaTopicConfig"
    module: "omnibase_infra.models.kafka.model_kafka_topic_config"
    description: "Shared Kafka topic configuration model"
  
  - name: "model_kafka_producer_config"
    type: "model"
    class_name: "ModelKafkaProducerConfig"
    module: "omnibase_infra.models.kafka.model_kafka_producer_config"
    description: "Shared Kafka producer configuration model"
  
  - name: "model_kafka_consumer_config"
    type: "model"
    class_name: "ModelKafkaConsumerConfig"
    module: "omnibase_infra.models.kafka.model_kafka_consumer_config"
    description: "Shared Kafka consumer configuration model"
  
  - name: "model_kafka_health_response"
    type: "model"
    class_name: "ModelKafkaHealthResponse"
    module: "omnibase_infra.models.kafka.model_kafka_health_response"
    description: "Shared Kafka health check response model"
    
  - name: "model_configuration_subcontract"
    type: "model"
    class_name: "ModelConfigurationSubcontract"
    module: "omnibase_infra.models.infrastructure.model_configuration_subcontract"
    description: "Shared configuration management subcontract model (temporary - will move to omnibase_core)"

# === EVENT TYPE CONFIGURATION ===
event_type:
  primary_events: ["kafka_message_produce", "kafka_message_consume", "kafka_topic_management", "kafka_health_check"]
  event_categories: ["infrastructure", "messaging", "streaming"]
  publish_events: true
  subscribe_events: true
  event_routing: "infrastructure"

# === INPUT/OUTPUT STATE ===
input_state:
  object_type: "object"
  required:
    - "operation_type"
    - "correlation_id"
    - "timestamp"
  properties:
    operation_type:
      property_type: "string"
      enum: ["produce", "consume", "topic_create", "topic_delete", "health_check"]
      description: "Type of Kafka operation to perform"
    
    message:
      property_type: "object"
      description: "Kafka message payload (for produce operations)"
      reference: "ModelKafkaMessage"
    
    topic_config:
      property_type: "object"
      description: "Topic configuration (for topic operations)"
      reference: "ModelKafkaTopicConfig"
    
    producer_config:
      property_type: "object"
      description: "Producer configuration (for produce operations)"
      reference: "ModelKafkaProducerConfig"
    
    consumer_config:
      property_type: "object"
      description: "Consumer configuration (for consume operations)"
      reference: "ModelKafkaConsumerConfig"
    
    correlation_id:
      property_type: "string"
      description: "Request correlation ID for tracing"
      format: "uuid"
    
    timestamp:
      property_type: "number"
      description: "Request timestamp"
    
    context:
      property_type: "object"
      description: "Additional request context"

output_state:
  object_type: "object"
  properties:
    operation_type:
      property_type: "string"
      description: "Type of operation that was executed"
      enum: ["produce", "consume", "topic_create", "topic_delete", "health_check"]
    
    messages:
      property_type: "array"
      description: "Consumed messages (for consume operations)"
      items:
        reference: "ModelKafkaMessage"
    
    topic_info:
      property_type: "object"
      description: "Topic information (for topic operations)"
    
    health_response:
      property_type: "object"
      description: "Health check response payload"
      reference: "ModelKafkaHealthResponse"
    
    success:
      property_type: "boolean"
      description: "Whether the operation was successful"
    
    error_message:
      property_type: "string"
      description: "Error message if operation failed"
    
    correlation_id:
      property_type: "string"
      description: "Request correlation ID for tracing"
      format: "uuid"
    
    timestamp:
      property_type: "number"
      description: "Response timestamp"
    
    execution_time_ms:
      property_type: "number"
      description: "Total operation execution time in milliseconds"
    
    record_count:
      property_type: "integer"
      description: "Number of records processed"

# === IO OPERATIONS (Required for EFFECT nodes) ===
io_operations:
  - operation_type: "kafka_message_produce"
    atomic: true
    backup_enabled: false
    permissions: null
    recursive: false
    buffer_size: 65536
    timeout_seconds: 30
    validation_enabled: true
  
  - operation_type: "kafka_message_consume"
    atomic: false
    backup_enabled: false
    permissions: null
    recursive: false
    buffer_size: 65536
    timeout_seconds: 60
    validation_enabled: true
  
  - operation_type: "kafka_topic_create"
    atomic: true
    backup_enabled: true
    permissions: null
    recursive: false
    buffer_size: 8192
    timeout_seconds: 15
    validation_enabled: true
  
  - operation_type: "kafka_health_check"
    atomic: false
    backup_enabled: false
    permissions: null
    recursive: false
    buffer_size: 4096
    timeout_seconds: 10
    validation_enabled: true

# === SUBCONTRACTS ===
subcontracts:
  - name: "configuration_subcontract"
    path: "./contracts/configuration_subcontract.yaml"
    description: "Standardized configuration management for infrastructure nodes"
    integration_type: "mixin"
    
  - name: "kafka_event_processing_subcontract"
    path: "./contracts/kafka_event_processing_subcontract.yaml"
    description: "Event bus integration patterns for Kafka operations"
    integration_type: "mixin"
    
  - name: "kafka_connection_management_subcontract"
    path: "./contracts/kafka_connection_management_subcontract.yaml"
    description: "Connection pool and broker management patterns"
    integration_type: "mixin"

# === DEFINITIONS (Required by ModelContractContent) ===
definitions:
  models:
    ModelKafkaAdapterInput:
      type: "object"
      description: "Input envelope for Kafka adapter operations"
      properties:
        operation_type:
          type: "string"
          enum: ["produce", "consume", "topic_create", "topic_delete", "health_check"]
        message:
          $ref: "#/shared_models/ModelKafkaMessage"
        topic_config:
          $ref: "#/shared_models/ModelKafkaTopicConfig"
        producer_config:
          $ref: "#/shared_models/ModelKafkaProducerConfig"
        consumer_config:
          $ref: "#/shared_models/ModelKafkaConsumerConfig"
        correlation_id:
          type: "string"
          format: "uuid"
        timestamp:
          type: "number"
        context:
          type: "object"
      required: ["operation_type", "correlation_id", "timestamp"]

    ModelKafkaAdapterOutput:
      type: "object"
      description: "Output envelope for Kafka adapter operations"
      properties:
        operation_type:
          type: "string"
          enum: ["produce", "consume", "topic_create", "topic_delete", "health_check"]
        messages:
          type: "array"
          items:
            $ref: "#/shared_models/ModelKafkaMessage"
        topic_info:
          type: "object"
        health_response:
          $ref: "#/shared_models/ModelKafkaHealthResponse"
        success:
          type: "boolean"
        error_message:
          type: "string"
          nullable: true
        correlation_id:
          type: "string"
          format: "uuid"
        timestamp:
          type: "number"
        execution_time_ms:
          type: "number"
        record_count:
          type: "integer"
        context:
          type: "object"
      required: ["operation_type", "success", "correlation_id", "timestamp", "execution_time_ms"]

  schemas: {}
  
  responses: {}

# === SHARED MODEL REFERENCES ===
shared_models:
  ModelKafkaMessage:
    module: "omnibase_infra.models.kafka.model_kafka_message"
    class_name: "ModelKafkaMessage"
  
  ModelKafkaTopicConfig:
    module: "omnibase_infra.models.kafka.model_kafka_topic_config"
    class_name: "ModelKafkaTopicConfig"
  
  ModelKafkaProducerConfig:
    module: "omnibase_infra.models.kafka.model_kafka_producer_config"
    class_name: "ModelKafkaProducerConfig"
  
  ModelKafkaConsumerConfig:
    module: "omnibase_infra.models.kafka.model_kafka_consumer_config"
    class_name: "ModelKafkaConsumerConfig"
  
  ModelKafkaHealthResponse:
    module: "omnibase_infra.models.kafka.model_kafka_health_response"
    class_name: "ModelKafkaHealthResponse"