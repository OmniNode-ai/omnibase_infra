"""Workflow result data model for ONEX workflow coordination."""

from datetime import datetime
from typing import Optional
from uuid import UUID

from omnibase_core.model.model_base import ModelBase
from pydantic import Field, ConfigDict


class ModelWorkflowResultData(ModelBase):
    """Model for workflow execution result data in the ONEX workflow coordinator."""

    model_config = ConfigDict(extra="forbid")

    # Execution summary
    execution_summary: str = Field(
        default="",
        max_length=2000,
        description="High-level summary of workflow execution results"
    )
    primary_outcome: str = Field(
        default="unknown",
        description="Primary outcome of the workflow execution",
        examples=["success", "partial_success", "failure", "timeout", "cancelled"]
    )
    success_criteria_met: bool = Field(
        default=False,
        description="Whether all success criteria were satisfied"
    )
    
    # Output data and artifacts
    output_files: list[str] = Field(
        default_factory=list,
        description="List of output files generated by the workflow"
    )
    generated_artifacts: list[str] = Field(
        default_factory=list,
        description="List of artifacts produced during workflow execution"
    )
    data_products: dict[str, str] = Field(
        default_factory=dict,
        description="Key-value pairs of data products created (name -> location)"
    )
    
    # Business and domain results
    business_metrics: dict[str, float] = Field(
        default_factory=dict,
        description="Business-relevant metrics from workflow execution"
    )
    kpi_results: dict[str, float] = Field(
        default_factory=dict,
        description="Key Performance Indicator results"
    )
    quality_scores: dict[str, float] = Field(
        default_factory=dict,
        description="Quality assessment scores (0-100 scale)"
    )
    
    # Technical results
    performance_metrics: dict[str, float] = Field(
        default_factory=dict,
        description="Technical performance metrics from execution"
    )
    resource_consumption: dict[str, float] = Field(
        default_factory=dict,
        description="Resource consumption metrics (CPU, memory, disk, network)"
    )
    optimization_gains: dict[str, float] = Field(
        default_factory=dict,
        description="Performance optimizations achieved"
    )
    
    # Compliance and security results
    compliance_status: dict[str, bool] = Field(
        default_factory=dict,
        description="Compliance requirement satisfaction status"
    )
    security_scan_results: dict[str, str] = Field(
        default_factory=dict,
        description="Security scan results and findings"
    )
    audit_trail: list[str] = Field(
        default_factory=list,
        description="Audit trail entries for compliance tracking"
    )
    
    # Processing statistics
    records_processed: int = Field(
        default=0,
        ge=0,
        description="Total number of records processed"
    )
    records_successful: int = Field(
        default=0,
        ge=0,
        description="Number of records processed successfully"
    )
    records_failed: int = Field(
        default=0,
        ge=0,
        description="Number of records that failed processing"
    )
    records_skipped: int = Field(
        default=0,
        ge=0,
        description="Number of records skipped during processing"
    )
    
    # Error and warning summaries
    error_summary: dict[str, int] = Field(
        default_factory=dict,
        description="Summary of errors by type/category"
    )
    warning_summary: dict[str, int] = Field(
        default_factory=dict,
        description="Summary of warnings by type/category"
    )
    critical_issues: list[str] = Field(
        default_factory=list,
        description="List of critical issues encountered"
    )
    
    # Validation results
    validation_results: dict[str, bool] = Field(
        default_factory=dict,
        description="Results of various validation checks"
    )
    test_results: dict[str, str] = Field(
        default_factory=dict,
        description="Automated test results (test_name -> result_status)"
    )
    
    # Integration and connectivity results
    external_service_calls: dict[str, int] = Field(
        default_factory=dict,
        description="Number of calls made to external services"
    )
    api_response_times: dict[str, float] = Field(
        default_factory=dict,
        description="Response times for external API calls"
    )
    database_operations: dict[str, int] = Field(
        default_factory=dict,
        description="Database operation counts by type"
    )
    
    # Agent coordination results
    agent_utilization: dict[str, float] = Field(
        default_factory=dict,
        description="Agent utilization percentages during execution"
    )
    coordination_efficiency: float = Field(
        default=0.0,
        ge=0.0,
        le=100.0,
        description="Overall coordination efficiency percentage"
    )
    parallel_execution_gains: float = Field(
        default=0.0,
        description="Time saved through parallel execution (seconds)"
    )
    
    # Cost and resource analysis
    estimated_cost: Optional[float] = Field(
        None,
        ge=0.0,
        description="Estimated cost of workflow execution"
    )
    resource_costs: dict[str, float] = Field(
        default_factory=dict,
        description="Breakdown of costs by resource type"
    )
    efficiency_score: float = Field(
        default=0.0,
        ge=0.0,
        le=100.0,
        description="Overall efficiency score (0-100)"
    )
    
    # Recommendations and insights
    optimization_recommendations: list[str] = Field(
        default_factory=list,
        description="Recommendations for improving future executions"
    )
    lessons_learned: list[str] = Field(
        default_factory=list,
        description="Key lessons learned from this execution"
    )
    next_actions: list[str] = Field(
        default_factory=list,
        description="Recommended next actions based on results"
    )
    
    # Metadata and context
    result_confidence: float = Field(
        default=100.0,
        ge=0.0,
        le=100.0,
        description="Confidence level in the results (0-100%)"
    )
    data_freshness: datetime = Field(
        default_factory=datetime.utcnow,
        description="Timestamp indicating when result data was last updated"
    )
    version_info: dict[str, str] = Field(
        default_factory=dict,
        description="Version information for components used"
    )
    tags: list[str] = Field(
        default_factory=list,
        description="Tags for categorizing and filtering results"
    )