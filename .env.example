# =============================================================================
# ONEX Infrastructure Environment Configuration
# =============================================================================
# Copy this file to .env and configure with your specific values.
#
# HOSTNAME RESOLUTION:
# -------------------
# This project supports two usage patterns:
#
# 1. DOCKER CONTAINERS (integration tests, docker-compose):
#    - Use service hostnames like: omninode-bridge-postgres, omninode-bridge-redpanda
#    - Hostnames resolve via Docker's extra_hosts mapping in docker-compose.yaml
#    - extra_hosts maps hostnames to REMOTE_HOST (default: host-gateway or IP address)
#    - Example: POSTGRES_HOST=omninode-bridge-postgres
#
# 2. LOCAL/DIRECT ACCESS (scripts, local development):
#    - Use IP addresses directly: 192.168.86.200 (or localhost for local services)
#    - No Docker hostname resolution needed
#    - Example: POSTGRES_HOST=192.168.86.200
#
# The docker-compose.yaml uses extra_hosts to map service hostnames:
#   extra_hosts:
#     - "omninode-bridge-postgres:${REMOTE_HOST:-host-gateway}"
#     - "omninode-bridge-redpanda:${REMOTE_HOST:-host-gateway}"
#
# For remote infrastructure, set REMOTE_HOST to the server IP (e.g., 192.168.86.200)
#
# SECURITY WARNING:
#   - Replace ALL placeholder values (marked __REPLACE_WITH_*__) before deployment
#   - Generate secure passwords using: openssl rand -base64 32
#   - Keep .env file out of version control (already in .gitignore)
#   - NEVER use placeholder values in any environment (dev/staging/prod)
# =============================================================================

# =============================================================================
# PostgreSQL Database Configuration
# =============================================================================
# For Docker/integration tests: Use hostname (resolves via extra_hosts)
#   POSTGRES_HOST=omninode-bridge-postgres
# For local scripts/direct access: Use IP address
#   POSTGRES_HOST=192.168.86.200
POSTGRES_HOST=your-postgres-host
POSTGRES_PORT=5432
POSTGRES_DATABASE=your_database
POSTGRES_USER=postgres
# SECURITY: Replace this placeholder with a secure password
# Generate using: openssl rand -base64 32
POSTGRES_PASSWORD=__REPLACE_WITH_SECURE_PASSWORD__

# PostgreSQL advanced settings (optional - defaults shown)
# Connection pooling configuration for high-performance scenarios
# POSTGRES_POOL_MIN_SIZE=1
# POSTGRES_POOL_MAX_SIZE=5
# POSTGRES_COMMAND_TIMEOUT_SECONDS=30.0

# Alternative: Full DSN format (overrides individual host/port/database settings)
# Useful for advanced connection options or when migrating from other systems.
# Format: postgresql://user:password@host:port/database
# POSTGRES_DSN=postgresql://postgres:password@localhost:5432/omninode_bridge

# =============================================================================
# Kafka / Redpanda Event Bus Configuration
# =============================================================================
# For Docker/integration tests: Use hostname with internal port (resolves via extra_hosts)
#   KAFKA_BOOTSTRAP_SERVERS=omninode-bridge-redpanda:9092
# For local scripts/direct access: Use IP address with external port
#   KAFKA_BOOTSTRAP_SERVERS=192.168.86.200:29092
KAFKA_BOOTSTRAP_SERVERS=your-kafka-host:9092

# Kafka advanced settings (optional - defaults shown)
# KAFKA_ENVIRONMENT=local
# KAFKA_GROUP=default
# KAFKA_TIMEOUT_SECONDS=30
# KAFKA_MAX_RETRY_ATTEMPTS=3
# KAFKA_RETRY_BACKOFF_BASE=1.0
# KAFKA_CIRCUIT_BREAKER_THRESHOLD=5
# KAFKA_CIRCUIT_BREAKER_RESET_TIMEOUT=30.0
# KAFKA_CONSUMER_SLEEP_INTERVAL=0.1
# KAFKA_ACKS=all
# KAFKA_ENABLE_IDEMPOTENCE=true
# KAFKA_AUTO_OFFSET_RESET=latest
# KAFKA_ENABLE_AUTO_COMMIT=true
# KAFKA_DEAD_LETTER_TOPIC=

# =============================================================================
# Consul Service Discovery Configuration
# =============================================================================
# For Docker/integration tests: Use hostname (resolves via extra_hosts)
#   CONSUL_HOST=omninode-bridge-consul
# For local scripts/direct access: Use IP address
#   CONSUL_HOST=192.168.86.200
CONSUL_HOST=your-consul-host
CONSUL_PORT=8500
CONSUL_DNS_PORT=18600
CONSUL_SCHEME=http
CONSUL_LOG_LEVEL=INFO

# Consul advanced settings (optional - defaults shown)
# SECURITY: Replace placeholder with your Consul ACL token
# CONSUL_TOKEN=__REPLACE_WITH_CONSUL_ACL_TOKEN__
# CONSUL_TIMEOUT_SECONDS=30.0
# CONSUL_CONNECT_TIMEOUT_SECONDS=10.0
# CONSUL_DATACENTER=dc1
# CONSUL_HEALTH_CHECK_INTERVAL_SECONDS=30.0
# CONSUL_CIRCUIT_BREAKER_THRESHOLD=5
# CONSUL_CIRCUIT_BREAKER_RESET_TIMEOUT_SECONDS=30.0

# =============================================================================
# Vault Secret Management Configuration
# =============================================================================
# For Docker/integration tests: Use hostname (resolves via extra_hosts)
#   VAULT_ADDR=http://omninode-bridge-vault:8200
# For local scripts/direct access: Use IP address
#   VAULT_ADDR=http://192.168.86.200:8200
VAULT_ADDR=http://your-vault-host:8200
# SECURITY: Replace this placeholder with your Vault token
# For development: Use Vault's root token from initial setup
# For production: Use a properly scoped token with minimal permissions
VAULT_TOKEN=__REPLACE_WITH_VAULT_TOKEN__
# Optional: Vault namespace for enterprise deployments
# VAULT_NAMESPACE=

# =============================================================================
# Redis / Valkey Cache Configuration
# =============================================================================
# For Docker/integration tests: Use hostname (resolves via extra_hosts)
#   REDIS_HOST=omninode-bridge-valkey
# For local scripts/direct access: Use IP address
#   REDIS_HOST=192.168.86.200
REDIS_HOST=your-redis-host
REDIS_PORT=6379
# SECURITY: Replace this placeholder with a secure password
# Generate using: openssl rand -base64 32
REDIS_PASSWORD=__REPLACE_WITH_SECURE_PASSWORD__

# =============================================================================
# RedPanda Event Streaming Configuration
# =============================================================================
# RedPanda broker ports (non-standard ports for security)
REDPANDA_PORT=19092
REDPANDA_EXTERNAL_PORT=19102
REDPANDA_ADMIN_PORT=19654
REDPANDA_PROXY_PORT=18092
REDPANDA_LOG_LEVEL=info
REDPANDA_DEFAULT_PARTITIONS=3
REDPANDA_DEFAULT_REPLICATION_FACTOR=1
REDPANDA_LOG_RETENTION_MS=604800000
REDPANDA_SEGMENT_MS=86400000

# RedPanda UI (non-standard port for security)
REDPANDA_UI_PORT=18109

# =============================================================================
# ONEX Adapter Service Ports
# =============================================================================
# PostgreSQL Adapter (non-standard port for security)
POSTGRES_ADAPTER_PORT=18085

# Consul Adapter (non-standard port for security)
CONSUL_ADAPTER_PORT=18087

# =============================================================================
# GitHub Configuration
# =============================================================================
# Token for private repository access (package installation)
GITHUB_TOKEN=__REPLACE_WITH_GITHUB_TOKEN__

# =============================================================================
# Webhook Notifications Configuration
# =============================================================================
# Slack Webhook for Infrastructure Alerts
# Get your webhook URL from: Slack App -> Incoming Webhooks -> Copy webhook URL
SLACK_WEBHOOK_URL=__REPLACE_WITH_SLACK_WEBHOOK_URL__

# Optional: Additional webhook configurations for multi-channel notifications
# DISCORD_WEBHOOK_URL=__REPLACE_WITH_DISCORD_WEBHOOK_URL__
# TEAMS_WEBHOOK_URL=__REPLACE_WITH_TEAMS_WEBHOOK_URL__

# =============================================================================
# ONEX Runtime Configuration
# =============================================================================
# Core runtime settings for the ONEX kernel and services.

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
ONEX_LOG_LEVEL=INFO

# Environment name: local, development, staging, production
ONEX_ENVIRONMENT=local

# HTTP port for health check server (internal container port)
ONEX_HTTP_PORT=8085

# Contracts directory path (for contract-driven configuration)
# ONEX_CONTRACTS_DIR=./contracts                    # Preferred name
#
# Legacy name (deprecated, will be removed in future version):
# CONTRACTS_DIR=./contracts

# Kafka topics for main runtime
ONEX_INPUT_TOPIC=requests
ONEX_OUTPUT_TOPIC=responses
ONEX_GROUP_ID=onex-runtime-main

# Effects runtime Kafka topics (optional)
# ONEX_EFFECTS_INPUT_TOPIC=effect-requests
# ONEX_EFFECTS_OUTPUT_TOPIC=effect-responses
# ONEX_EFFECTS_GROUP_ID=onex-runtime-effects

# Worker runtime Kafka topics (optional)
# ONEX_WORKER_INPUT_TOPIC=worker-requests
# ONEX_WORKER_OUTPUT_TOPIC=worker-responses
# ONEX_WORKER_GROUP_ID=onex-runtime-workers

# =============================================================================
# Registration Orchestrator Configuration (Optional)
# =============================================================================
# Liveness interval for node heartbeat monitoring.
# After this interval, nodes that don't send heartbeats are considered expired.
# ONEX_LIVENESS_INTERVAL_SECONDS=60      # Range: 1-3600 (default: 60)

# =============================================================================
# Runtime Scheduler Configuration (Optional)
# =============================================================================
# Tick scheduler for emitting RuntimeTick events.
# RUNTIME_SCHEDULER_TICK_INTERVAL_MS=1000
# RUNTIME_SCHEDULER_ID=runtime-scheduler-default
# RUNTIME_SCHEDULER_TICK_TOPIC=runtime.tick.v1
# RUNTIME_SCHEDULER_PERSIST_SEQUENCE=true
# RUNTIME_SCHEDULER_SEQUENCE_KEY=runtime_scheduler_sequence
# RUNTIME_SCHEDULER_MAX_JITTER_MS=100
# RUNTIME_SCHEDULER_CB_THRESHOLD=5
# RUNTIME_SCHEDULER_CB_RESET_TIMEOUT=60.0
# RUNTIME_SCHEDULER_ENABLE_METRICS=true
# RUNTIME_SCHEDULER_METRICS_PREFIX=runtime_scheduler

# =============================================================================
# Compute Registry Configuration (Optional)
# =============================================================================
# Semver LRU cache size for plugin version resolution.
# Increase for large deployments with many unique version strings.
# ONEX_COMPUTE_REGISTRY_CACHE_SIZE=128   # Range: 1-10000 (default: 128)
#
# Legacy name (deprecated, will be removed in future version):
# COMPUTE_REGISTRY_CACHE_SIZE=128

# =============================================================================
# Performance Threshold Configuration (Optional)
# =============================================================================
# Thresholds for performance monitoring in the registration reducer.
# Adjust for stricter production monitoring or relaxed dev/CI environments.
#
# reduce() processing threshold in milliseconds (default: 300.0)
# ONEX_PERF_THRESHOLD_REDUCE_MS=300.0
#
# Intent building threshold in milliseconds (default: 50.0)
# ONEX_PERF_THRESHOLD_INTENT_BUILD_MS=50.0
#
# Idempotency check threshold in milliseconds (default: 1.0)
# ONEX_PERF_THRESHOLD_IDEMPOTENCY_CHECK_MS=1.0

# =============================================================================
# ONEX Handler Configuration (Optional)
# =============================================================================
# HTTP handler settings for request/response processing.
# ONEX_HTTP_TIMEOUT=30.0         # Range: 0.1-3600.0 seconds
# ONEX_HTTP_MAX_REQUEST_SIZE=10485760   # Range: 1-1073741824 bytes (1B to 1GB)
# ONEX_HTTP_MAX_RESPONSE_SIZE=52428800  # Range: 1-1073741824 bytes (1B to 1GB)

# Database handler settings for query execution.
# ONEX_DB_POOL_SIZE=5            # Range: 1-100
# ONEX_DB_TIMEOUT=30.0           # Range: 0.1-3600.0 seconds

# =============================================================================
# ONEX Runtime Timeout Configuration (Optional)
# =============================================================================
# Health check timeout in seconds (default: 5.0, range: 1.0-60.0)
# Controls how long health probes wait before timing out.
# ONEX_HEALTH_CHECK_TIMEOUT=5.0

# Graceful shutdown drain timeout in seconds (default: 30.0, range: 1.0-300.0)
# Controls how long the runtime waits for in-flight requests during shutdown.
# ONEX_DRAIN_TIMEOUT=30.0

# =============================================================================
# Circuit Breaker Configuration (Optional)
# =============================================================================
# Global circuit breaker settings for external service integrations.
# These defaults can be overridden per-service (e.g., KAFKA_CIRCUIT_BREAKER_*).
#
# Maximum consecutive failures before opening circuit (default: 5)
# When reached, the circuit opens and fails fast without attempting calls.
# ONEX_CB_THRESHOLD=5            # Range: 1+ (minimum 1)

# Seconds before automatic transition from OPEN to HALF_OPEN (default: 60.0)
# After this timeout, the circuit allows a test request through.
# ONEX_CB_RESET_TIMEOUT=60.0     # Range: 0+ seconds

# =============================================================================
# Idempotency Store Configuration (Optional)
# =============================================================================
# Settings for the idempotency store used to prevent duplicate processing.
# The store tracks processed event IDs with automatic cleanup of old records.
#
# Time-to-live for idempotency records in seconds (default: 86400 = 24 hours)
# Records older than this are eligible for cleanup.
# ONEX_IDEMPOTENCY_TTL_SECONDS=86400        # Range: 60-2592000 (1 min to 30 days)

# Interval between cleanup runs in seconds (default: 3600 = 1 hour)
# Controls how frequently the background cleanup task runs.
# ONEX_IDEMPOTENCY_CLEANUP_INTERVAL=3600    # Range: 60-86400 (1 min to 24 hours)

# Number of records to delete per cleanup batch (default: 10000)
# Limits memory and transaction size during cleanup operations.
# ONEX_IDEMPOTENCY_BATCH_SIZE=10000         # Range: 100-100000

# =============================================================================
# Snapshot Topic Configuration (Optional)
# =============================================================================
# Kafka snapshot topic settings for state persistence.
# SNAPSHOT_TOPIC=onex.registration.snapshots
# SNAPSHOT_PARTITION_COUNT=12
# SNAPSHOT_REPLICATION_FACTOR=3
# SNAPSHOT_MIN_COMPACTION_LAG_MS=60000
# SNAPSHOT_MAX_COMPACTION_LAG_MS=300000
# SNAPSHOT_SEGMENT_BYTES=104857600
# SNAPSHOT_RETENTION_MS=-1
# SNAPSHOT_MIN_INSYNC_REPLICAS=2

# =============================================================================
# OpenTelemetry Observability Configuration (Optional)
# =============================================================================
# OTLP exporter endpoint for distributed tracing and metrics.
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# Service name for tracing identification
# OTEL_SERVICE_NAME=omnibase-infra-runtime

# Exporter types: otlp, console, none
# OTEL_TRACES_EXPORTER=otlp
# OTEL_METRICS_EXPORTER=otlp

# =============================================================================
# Docker/Network Configuration (Optional)
# =============================================================================
# Docker network name for inter-service communication.
# Must match the network created by omninode-bridge infrastructure.
# DOCKER_NETWORK=omninode-bridge-network

# IMPORTANT: REMOTE_HOST controls hostname resolution in Docker containers.
# This value is used by extra_hosts in docker-compose.yaml to map service
# hostnames (like omninode-bridge-postgres) to actual IP addresses.
#
# For local services (running on same machine):
#   REMOTE_HOST=host-gateway  (default - resolves to Docker host IP)
#
# For remote services (running on different machine):
#   REMOTE_HOST=192.168.86.200  (or your remote server's IP)
#
# How it works:
#   docker-compose.yaml has: extra_hosts: ["omninode-bridge-postgres:${REMOTE_HOST}"]
#   This makes the hostname resolve to REMOTE_HOST inside containers.
# REMOTE_HOST=host-gateway

# Host port mappings for runtime services
# RUNTIME_MAIN_PORT=8085
# RUNTIME_EFFECTS_PORT=8086

# Number of worker replicas for horizontal scaling
# WORKER_REPLICAS=2
