# Node Manifest for PostgreSQL Adapter Infrastructure Node
# Defines metadata and configuration for ONEX infrastructure node registration

node_name: "postgres_adapter"
node_version: 1.0.0
node_type: "infrastructure"
category: "database_adapter"

metadata:
  display_name: "PostgreSQL Infrastructure Adapter"
  description: "Message bus bridge for PostgreSQL database operations"
  author: "ONEX Infrastructure Team"
  created_date: "2025-09-11"

  # Infrastructure classification
  infrastructure_category: "database"
  service_integration: "postgresql"
  adapter_type: "message_bus_bridge"

# Node registration details
registration:
  main_class: "Node"
  module_path: "omnibase_infra.nodes.postgres_adapter.v1_0_0.node"
  contract_path: "./v1_0_0/contract.yaml"

  # Dependencies for node loading
  dependencies:
    - "omnibase_infra.infrastructure.postgres_connection_manager"
    - "omnibase_infra.models.postgres"

# Service configuration
service:
  service_name: "postgres_adapter_effect"
  service_type: "effect"
  event_routing: "infrastructure"

  # Connection requirements
  external_services:
    - name: "postgresql"
      type: "database"
      required: true
      health_check_enabled: true

# Deployment configuration
deployment:
  resource_requirements:
    memory_mb: 256
    cpu_cores: 0.5
    disk_mb: 100

  environment_variables:
    - name: "POSTGRES_HOST"
      description: "PostgreSQL server host"
      default: "localhost"

    - name: "POSTGRES_PORT"
      description: "PostgreSQL server port"
      default: "5432"

    - name: "POSTGRES_DATABASE"
      description: "PostgreSQL database name"
      default: "omnibase_infrastructure"

    - name: "POSTGRES_SCHEMA"
      description: "Default PostgreSQL schema"
      default: "infrastructure"

# Monitoring and observability
observability:
  health_check_endpoint: "/health"
  metrics_enabled: true
  logging_level: "INFO"

  # Key metrics to track
  metrics:
    - "postgres.connection_pool_size"
    - "postgres.query_execution_time"
    - "postgres.event_processing_latency"
    - "postgres.database_errors"

# Node capabilities
capabilities:
  operations:
    - "query_execution"
    - "health_monitoring"
    - "connection_management"
    - "event_processing"

  patterns:
    - "message_bus_integration"
    - "connection_pooling"
    - "error_recovery"
    - "performance_monitoring"

# Integration points
integration:
  event_bus:
    subscribes_to:
      - "postgres_query_request"
      - "postgres_health_check_request"

    publishes:
      - "postgres_query_completed"
      - "postgres_health_status_changed"
      - "postgres_operation_failed"

  subcontracts:
    - "postgres_event_processing_subcontract"
    - "postgres_connection_management_subcontract"

# Quality gates
quality:
  test_coverage_minimum: 80
  performance_requirements:
    query_latency_max: "100ms"
    connection_acquisition_max: "50ms"
    event_processing_max: "10ms"

  security:
    credential_management: "environment_variables"
    ssl_support: true
    audit_logging: true
