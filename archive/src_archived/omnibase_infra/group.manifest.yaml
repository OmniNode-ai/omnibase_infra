# ONEX Service Group Manifest - Infrastructure Group
# Tier 1: Service group level metadata for infrastructure services

# === GROUP IDENTITY ===
group_name: "infrastructure"
group_version: {major: 1, minor: 0, patch: 0}
group_type: "infrastructure_services"
description: "Core infrastructure services for ONEX platform including database adapters, service discovery, message streaming, and secret management"

# === GROUP METADATA ===
metadata:
  display_name: "ONEX Infrastructure Services"
  author: "ONEX Infrastructure Team"
  created_date: "2025-09-11T00:00:00Z"
  last_modified_date: "2025-09-12T00:00:00Z"
  category: "infrastructure"
  classification: "platform_services"

# === GROUP STATUS ===
status: "active"
lifecycle: "production"
maturity_level: "stable"

# === NODE CATALOG ===
nodes:
  - node_name: "postgres_adapter"
    node_type: "EFFECT"
    description: "PostgreSQL message bus bridge adapter for database operations"
    current_version: {major: 1, minor: 0, patch: 0}
    status: "active"
    service_integration: "postgresql"

  - node_name: "consul_adapter"
    node_type: "EFFECT"
    description: "Consul service discovery and KV store adapter"
    current_version: {major: 1, minor: 0, patch: 0}
    status: "planned"
    service_integration: "consul"

  - node_name: "kafka_adapter"
    node_type: "EFFECT"
    description: "Kafka/RedPanda event streaming adapter"
    current_version: {major: 1, minor: 0, patch: 0}
    status: "planned"
    service_integration: "redpanda"

  - node_name: "vault_adapter"
    node_type: "EFFECT"
    description: "HashiCorp Vault secret management adapter"
    current_version: {major: 1, minor: 0, patch: 0}
    status: "planned"
    service_integration: "vault"

  - node_name: "infrastructure_reducer"
    node_type: "REDUCER"
    description: "Infrastructure state consolidation and decision making"
    current_version: {major: 1, minor: 0, patch: 0}
    status: "planned"
    service_integration: "internal"

  - node_name: "infrastructure_orchestrator"
    node_type: "ORCHESTRATOR"
    description: "Infrastructure workflow coordination and service orchestration"
    current_version: {major: 1, minor: 0, patch: 0}
    status: "planned"
    service_integration: "internal"

# === SERVICE INTEGRATION ===
external_services:
  postgresql:
    description: "PostgreSQL database for data persistence"
    required: true
    default_port: 5432
    health_check: "SELECT 1"

  redpanda:
    description: "RedPanda event streaming platform"
    required: true
    default_port: 9092
    health_check: "kafka_admin"

  consul:
    description: "HashiCorp Consul for service discovery"
    required: false
    default_port: 8500
    health_check: "/v1/status/leader"

  vault:
    description: "HashiCorp Vault for secret management"
    required: false
    default_port: 8200
    health_check: "/v1/sys/health"

# === EVENT BUS INTEGRATION ===
event_bus:
  provider: "redpanda"
  namespace: "infrastructure"
  topic_patterns:
    - "*.omnibase.onex.evt.postgres-*"
    - "*.omnibase.onex.evt.consul-*"
    - "*.omnibase.onex.cmd.infrastructure-*"
    - "*.omnibase.onex.qrs.service-discovery-*"

  publishing_patterns:
    - node_type: "EFFECT"
      publishes: ["evt.*", "aud.*"]
    - node_type: "COMPUTE"
      publishes: ["cmd.*", "qrs.*"]
    - node_type: "REDUCER"
      publishes: ["evt.*", "ctl.*"]
    - node_type: "ORCHESTRATOR"
      publishes: ["cmd.*", "ctl.*"]

# === DEPLOYMENT CONFIGURATION ===
deployment:
  container_strategy: "single_container_per_group"
  resource_allocation:
    total_memory_mb: 1024
    total_cpu_cores: 2
    shared_storage_mb: 500

  environment_requirements:
    - name: "OMNINODE_ENV"
      description: "Environment namespace for OmniNode topics"
      default: "dev"
    - name: "OMNINODE_TENANT"
      description: "Tenant namespace for OmniNode topics"
      default: "omnibase"
    - name: "OMNINODE_CONTEXT"
      description: "Context namespace for OmniNode topics"
      default: "onex"

# === DEPENDENCY MANAGEMENT ===
dependencies:
  group_level:
    - name: "omnibase_core"
      type: "framework"
      version: ">=1.0.0"
      description: "Core ONEX framework components"

    - name: "event_bus_container"
      type: "container_service"
      version: ">=1.0.0"
      description: "Event bus container with RedPanda integration"

  external_packages:
    - name: "asyncpg"
      version: ">=0.29.0"
      description: "Async PostgreSQL adapter"

    - name: "aiokafka"
      version: ">=0.10.0"
      description: "Async Kafka/RedPanda client"

    - name: "consul"
      version: ">=1.1.0"
      description: "Consul Python client"
      optional: true

    - name: "hvac"
      version: ">=2.1.0"
      description: "HashiCorp Vault client"
      optional: true

# === SERVICE GROUP COORDINATION ===
coordination:
  container_injection: "single_shared_container"
  service_discovery: "automatic"
  load_balancing: "round_robin"
  health_monitoring: "comprehensive"

  scaling_strategy:
    min_instances: 1
    max_instances: 5
    scaling_metric: "cpu_utilization"
    scaling_threshold: 75

# === QUALITY REQUIREMENTS ===
quality:
  group_level_requirements:
    availability: "99.9%"
    latency_p95: "100ms"
    error_rate_max: "0.1%"
    test_coverage_min: 85

  security_requirements:
    authentication: "required"
    authorization: "rbac"
    audit_logging: "comprehensive"
    encryption_at_rest: "required"
    encryption_in_transit: "required"

  monitoring_requirements:
    metrics_collection: "mandatory"
    log_aggregation: "structured"
    distributed_tracing: "enabled"
    health_checks: "continuous"

# === SCHEMA VALIDATION ===
schema_version: {major: 1, minor: 0, patch: 0}
manifest_type: "group_manifest"
onex_compliance: "SP0_BOOTSTRAP"
