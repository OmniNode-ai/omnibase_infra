[pytest]
# Pytest configuration for MetadataStampingService comprehensive test suite

# Test discovery
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Minimum Python version
minversion = 3.11

# Test paths
testpaths =
    tests/compliance
    tests/performance
    tests/integration
    src/omninode_bridge/services/metadata_stamping/tests

# Markers for test categorization
markers =
    # Compliance markers
    compliance: O.N.E. v0.1 protocol compliance tests
    schema: Schema validation tests
    api_standards: API standards compliance tests

    # Performance markers
    performance: Performance and benchmarking tests
    benchmark: Detailed performance benchmarks
    batch: Batch processing performance tests
    throughput: Throughput validation tests
    latency: Latency measurement tests

    # Integration markers
    integration: End-to-end integration tests
    unified_models: Unified result model tests
    cross_service: Cross-service workflow tests
    database: Database integration tests

    # Compatibility markers
    compatibility: Backward compatibility tests
    legacy: Legacy API compatibility tests

    # Functional markers
    unit: Unit tests
    functional: Functional tests
    smoke: Smoke tests for basic functionality

    # Quality markers
    quality: Code quality validation tests
    security: Security-related tests
    error_handling: Error handling tests

    # Environment markers
    requires_db: Tests requiring database connection
    requires_docker: Tests requiring Docker environment
    slow: Tests that take significant time to run

    # Stress testing markers
    stress: Stress testing and load validation
    memory: Memory usage validation tests
    concurrency: Concurrent operation tests

# Test output configuration
addopts =
    --strict-markers
    --strict-config
    --tb=short
    --disable-warnings
    --color=yes
    --durations=10
    --cov=src/omninode_bridge/services/metadata_stamping
    --cov-report=term-missing
    --cov-report=html:coverage-data/metadata-stamping
    --cov-report=xml:coverage-data/metadata-stamping.xml
    --junitxml=coverage-data/metadata-stamping-junit.xml

# Asyncio configuration
asyncio_mode = auto

# Timeout configuration
timeout = 300
timeout_method = thread

# Parallel execution
# Note: Use with care for performance tests
# -n auto for parallel execution (requires pytest-xdist)

# Console output
console_output_style = progress

# Log configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Filterwarnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning

# Test collection
collect_ignore = [
    "setup.py",
    "conftest.py"
]
