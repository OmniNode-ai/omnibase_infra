# Test Generator Effect Node Contract - ONEX v2.0 Compliant
# Generated: 2025-10-30

# Required fields for ModelContractEffect
name: "test_generator"
version:
  major: 1
  minor: 0
  patch: 0
description: "Generates comprehensive test files from ModelContractTest contracts using Jinja2 templates"
node_type: "EFFECT"

# Input/Output Models (required by omnibase_core) - must be strings (model class names)
input_model: "ModelTestGeneratorRequest"
output_model: "ModelTestGeneratorResponse"

# Tool specification (required by omnibase_core)
tool_specification:
  tool_name: "test_generator"
  main_tool_class: "omninode_bridge.nodes.test_generator_effect.v1_0_0.node.NodeTestGeneratorEffect"

# Input State (required by ONEX v2.0)
input_state:
  type: object
  description: "Input state for test generation operations"
  properties:
    contract_path:
      type: string
      description: "Path to ModelContractTest contract file"
    test_types:
      type: array
      items:
        type: string
        enum: ["unit", "integration", "contract", "performance", "fixtures"]
      description: "Types of tests to generate"
      default: ["unit", "integration"]
    output_directory:
      type: string
      description: "Target directory for generated test files"
      default: "./tests"
    template_directory:
      type: string
      description: "Directory containing Jinja2 templates"
      default: "src/omninode_bridge/codegen/templates/test_templates"
    overwrite_policy:
      type: string
      enum: ["require_explicit", "always", "never"]
      description: "File overwrite policy"
      default: "require_explicit"
    validate_syntax:
      type: boolean
      description: "Validate generated Python syntax"
      default: true

# Output State (required by ONEX v2.0)
output_state:
  type: object
  description: "Output state after test generation"
  properties:
    success:
      type: boolean
      description: "Whether test generation completed successfully"
    generated_files:
      type: array
      items:
        type: object
        properties:
          file_path:
            type: string
          test_type:
            type: string
            enum: ["unit", "integration", "contract", "performance", "fixtures"]
          file_size_bytes:
            type: integer
            minimum: 0
          syntax_valid:
            type: boolean
      description: "List of generated test files with metadata"
    total_files_generated:
      type: integer
      minimum: 0
      description: "Total number of test files generated"
    performance_metrics:
      type: object
      description: "Performance metrics for generation"
      properties:
        execution_time_ms:
          type: number
          description: "Total execution time in milliseconds"
        template_render_time_ms:
          type: number
          description: "Time spent rendering templates"
        file_write_time_ms:
          type: number
          description: "Time spent writing files"
        validation_time_ms:
          type: number
          description: "Time spent validating syntax"
    templates_used:
      type: array
      items:
        type: string
      description: "List of Jinja2 templates used"
    syntax_errors:
      type: array
      items:
        type: object
        properties:
          file_path:
            type: string
          error_message:
            type: string
      description: "List of syntax validation errors (if any)"
    error_message:
      type: string
      description: "Error message if operation failed"

# IO operations for EFFECT node (required)
# Each operation follows ModelIOOperationConfig schema
io_operations:
  - operation_type: "file_write"
    atomic: true
    backup_enabled: false
    permissions: "0644"
    timeout_seconds: 30
    validation_enabled: true
  - operation_type: "template_render"
    atomic: false
    timeout_seconds: 60
    validation_enabled: true

# Subcontracts for specialized behavior
subcontracts:
  # Template rendering subcontract
  template_rendering:
    template_engine: "jinja2"
    template_directory: "src/omninode_bridge/codegen/templates/test_templates"
    autoescape: false
    supported_templates:
      - "test_unit.py.j2"
      - "test_integration.py.j2"
      - "test_contract.py.j2"
      - "test_performance.py.j2"
      - "conftest.py.j2"
    timeout_ms: 2000

  # File writing subcontract
  file_writing:
    create_directories: true
    overwrite_policy: "require_explicit"
    validate_syntax: true
    encoding: "utf-8"
    timeout_ms: 1000

# Legacy fields for compatibility
node_name: test_generator
node_version:
  major: 1
  minor: 0
  patch: 0

contract_name: test_generator_contract
author: OmniNode Code Generation
created_at: "2025-10-30"

# Core Metadata
metadata:
  domain: "code_generation"
  generated: false
  tags:
    - "test_generation"
    - "jinja2"
    - "code_quality"
    - "automation"

# Operations supported by this node
operations:
  - "generate_unit_tests"
  - "generate_integration_tests"
  - "generate_contract_tests"
  - "generate_performance_tests"
  - "generate_fixtures"

# Performance Requirements
performance_requirements:
  execution_time:
    target_ms: 2000  # 2 second target
    max_ms: 3000     # 3 second max
  memory_usage:
    target_mb: 128
    max_mb: 256
  throughput:
    target_operations_per_second: 10
    max_concurrent_operations: 5

# Testing Requirements
testing:
  unit_tests:
    coverage_target: 85
    required: true
  integration_tests:
    required: true
    test_scenarios:
      - "generate_unit_tests_from_contract"
      - "generate_integration_tests_from_contract"
      - "validate_generated_syntax"
      - "handle_template_errors"
      - "handle_file_write_errors"
