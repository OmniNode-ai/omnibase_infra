# Registry Node Configuration
# Base configuration for NodeBridgeRegistry
# Environment-specific overrides are applied from development.yaml or production.yaml

# Node identification
node:
  type: "registry"
  name: "bridge-registry"
  version: "0.1.0"
  namespace: "omninode.bridge.registry"

# Registry-specific settings
registry:
  # Node registration
  enable_auto_registration: true
  registration_interval_seconds: 30
  heartbeat_interval_seconds: 15
  heartbeat_timeout_seconds: 60

  # Service discovery
  enable_service_discovery: true
  discovery_refresh_interval_seconds: 60

  # Health checking
  enable_health_checks: true
  health_check_interval_seconds: 30
  health_check_timeout_seconds: 5

  # Node lifecycle
  node_ttl_seconds: 300
  enable_automatic_deregistration: true

  # Performance tuning
  max_registered_nodes: 1000
  node_cache_ttl_seconds: 60
  event_processing_buffer_size: 500

# Database configuration
database:
  host: "localhost"
  port: 5432
  database: "omninode_bridge"
  user: "postgres"
  # Password should be set via environment variable: POSTGRES_PASSWORD

  # Connection pooling
  pool_min_size: 3
  pool_max_size: 10
  pool_timeout_seconds: 10

  # Performance
  query_timeout_seconds: 30
  command_timeout_seconds: 60
  statement_cache_size: 50

# Consul service discovery
consul:
  host: "localhost"
  port: 8500
  # Enable service registration
  enable_registration: true
  registration_timeout_seconds: 10
  # Health check configuration
  health_check_interval_seconds: 30
  health_check_timeout_seconds: 5

# Kafka event streaming
kafka:
  bootstrap_servers: "localhost:9092"

  # Producer settings
  producer:
    compression_type: "snappy"
    batch_size: 16384
    linger_ms: 5
    acks: "all"
    max_in_flight_requests: 5

  # Consumer settings
  consumer:
    group_id: "bridge-registry-consumer"
    auto_offset_reset: "latest"
    enable_auto_commit: true
    auto_commit_interval_ms: 5000
    max_poll_records: 500

  # Topics
  topics:
    workflow_events: "omninode.bridge.workflow.events.v1"
    task_events: "omninode.bridge.task.events.v1"
    state_sync: "omninode.bridge.state.sync.v1"

# Logging configuration
logging:
  level: "INFO"
  format: "json"
  enable_structured_logging: true
  log_requests: true
  log_responses: false

  # Log destinations
  outputs:
    - type: "console"
      enabled: true
    - type: "file"
      enabled: true
      path: "logs/registry.log"
      max_size_mb: 100
      backup_count: 5

# Monitoring and metrics
monitoring:
  enable_prometheus: true
  prometheus_port: 9092
  metrics_interval_seconds: 15

  # Health checks
  health_check_interval_seconds: 30
  service_health_timeout_seconds: 5

  # Performance metrics
  track_workflow_latency: false
  track_task_latency: false
  track_dependency_resolution_time: false

# Circuit breaker configuration
circuit_breaker:
  enabled: true
  failure_threshold: 5
  recovery_timeout_seconds: 60
  half_open_max_requests: 3

# Caching configuration
cache:
  enabled: true
  workflow_state_ttl_seconds: 3600
  task_result_ttl_seconds: 1800
  max_cache_size_mb: 128
