# shared_key_registry.yaml
#
# Authoritative list of keys shared across all OmniNode repos.
# Keys come from ~/.omnibase/.env (shell env) at dev time,
# and from Infisical /shared/<transport>/ at runtime.
#
# Semantics:
#   shared            — eligible for Infisical seeding + repo .env stripping;
#                       loaded by _load_registry() in scripts/register-repo.py.
#                       A shared key represents the canonical platform-wide value.
#                       Some shared keys (e.g. POSTGRES_DSN) may also be seeded
#                       per-service under /services/<repo>/ via REPO_SECRET_KEYS
#                       in register-repo.py — those per-service entries are
#                       intentional overrides that take precedence at runtime.
#   bootstrap_only    — excluded from Infisical seeding (circular bootstrap dep);
#                       listed here for awareness only; must never be in any repo
#                       .env; loaded by _bootstrap_keys() in register-repo.py
#   identity_defaults — never in any .env; hardcoded as default= in Settings
#                       classes; loaded by _identity_defaults() in
#                       register-repo.py
#
# Used by:
#   - ~/.omnibase/scripts/onboard-repo.py  (strip shared keys from repo .env)
#   - scripts/register-repo.py seed-shared  (seed /shared/* in Infisical)
#
# version: increment minor when adding keys, major on breaking structural changes.
version: "1.0"
# Keys written to /shared/<transport>/ in Infisical.
shared:
  "/shared/db/":
    - POSTGRES_HOST
    - POSTGRES_PORT
    - POSTGRES_USER
    - POSTGRES_DSN # per-service override also seeded via REPO_SECRET_KEYS (see header)
    - POSTGRES_POOL_MIN_SIZE
    - POSTGRES_POOL_MAX_SIZE
    - POSTGRES_TIMEOUT_MS
  "/shared/kafka/":
    - KAFKA_REQUEST_TIMEOUT_MS
  "/shared/consul/":
    - CONSUL_HOST
    - CONSUL_PORT
    - CONSUL_SCHEME
    - CONSUL_ACL_TOKEN
    - CONSUL_ENABLED
  "/shared/vault/":
    - VAULT_ADDR
    - VAULT_TOKEN
  "/shared/llm/":
    - REMOTE_SERVER_IP
    - LLM_CODER_URL
    - LLM_CODER_FAST_URL
    - LLM_EMBEDDING_URL
    - LLM_DEEPSEEK_R1_URL
    - EMBEDDING_MODEL_URL
    - VLLM_SERVICE_URL
    - VLLM_DEEPSEEK_URL
    - VLLM_LLAMA_URL
    - ONEX_TREE_SERVICE_URL
    - METADATA_STAMPING_SERVICE_URL
  "/shared/auth/":
    - OPENAI_API_KEY
    - GOOGLE_API_KEY
    - GEMINI_API_KEY
    - Z_AI_API_KEY
    - Z_AI_API_URL
    - SERVICE_AUTH_TOKEN
    - GH_PAT
  "/shared/valkey/":
    - VALKEY_PASSWORD
  "/shared/qdrant/":
    - QDRANT_HOST
    - QDRANT_PORT
    - QDRANT_API_KEY
  "/shared/env/":
    - SLACK_WEBHOOK_URL
    - SLACK_BOT_TOKEN
    - SLACK_CHANNEL_ID
# Keys that must NEVER be seeded into Infisical (circular bootstrap dependency —
# Infisical needs these to start, so they cannot come FROM Infisical).
# These live OUTSIDE repos: POSTGRES_PASSWORD in ~/.omnibase/.env,
# INFISICAL_* credentials in ~/.omnibase/.env or deployment secrets.
# They must never appear in any repo .env file.
bootstrap_only:
  - POSTGRES_PASSWORD
  # TODO(OMN-2287): Moved from shared/kafka to bootstrap_only. Migration: any existing /shared/kafka/KAFKA_BOOTSTRAP_SERVERS
  # entry in a provisioned Infisical instance is now stale and can be deleted manually.
  - KAFKA_BOOTSTRAP_SERVERS # circular bootstrap dep: containers need this BEFORE Infisical is reachable
  - INFISICAL_ADDR
  - INFISICAL_CLIENT_ID
  - INFISICAL_CLIENT_SECRET
  - INFISICAL_PROJECT_ID
  - INFISICAL_ENCRYPTION_KEY
  - INFISICAL_AUTH_SECRET
# Keys that are per-repo identity config.
# Must NEVER appear in any .env file — hardcoded as default= in Settings classes.
identity_defaults:
  - POSTGRES_DATABASE
