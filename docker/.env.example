# =============================================================================
# ONEX Infrastructure Runtime - Environment Configuration
# =============================================================================
# Copy this file to .env and customize for your environment.
# All values shown are defaults - uncomment and modify as needed.
#
# ⚠️ SECURITY WARNING:
#   - ALL placeholder values (marked __REPLACE_WITH_*__) MUST be changed
#   - NEVER use these placeholders in ANY environment (dev/staging/prod)
#   - Generate secure random passwords using: openssl rand -base64 32
#   - Keep .env file out of version control (already in .gitignore)
#
# Usage:
#   cp .env.example .env
#   # Edit .env with your secure values (replace ALL __REPLACE_WITH_*__ placeholders)
#   docker compose -f docker-compose.runtime.yml up -d
# =============================================================================

# =============================================================================
# Build Configuration
# =============================================================================
# GitHub token for private package installation during Docker build.
# Required for installing omnibase-core and omnibase-spi from private repos.
# ⚠️ NOTE: Set this in your environment or shell, not in .env file
# For Docker builds: export GITHUB_TOKEN=$(cat ~/.github_token)
# The token is passed via BuildKit secret mount, not as a build arg.
GITHUB_TOKEN=__REPLACE_WITH_GITHUB_TOKEN__

# =============================================================================
# Runtime Version
# =============================================================================
# Version tag for container labels (used for tracking deployments)
# RUNTIME_VERSION=0.1.0

# =============================================================================
# Network Configuration
# =============================================================================
# Docker network name for inter-service communication.
# Must match the network created by omninode-bridge infrastructure.
# DOCKER_NETWORK=omninode-bridge-network

# Remote host override for extra_hosts mappings.
# Set to IP address when connecting to services on a different host.
# Default (host-gateway) resolves to the Docker host.
# REMOTE_HOST=host-gateway

# =============================================================================
# Kafka / Redpanda Event Bus Configuration
# =============================================================================
# Bootstrap servers for Kafka/Redpanda connection.
# Comma-separated list for multiple brokers: host1:9092,host2:9092
# KAFKA_BOOTSTRAP_SERVERS=omninode-bridge-redpanda:9092

# =============================================================================
# PostgreSQL Database Configuration
# =============================================================================
# Database connection parameters for persistent storage.
# POSTGRES_HOST=omninode-bridge-postgres
# POSTGRES_PORT=5432
# POSTGRES_DATABASE=omninode_bridge
# POSTGRES_USER=postgres

# REQUIRED - SECURITY: Must be set explicitly, no default value allowed
# ⚠️ CRITICAL: Replace this placeholder before ANY deployment!
# Generate a secure password: openssl rand -base64 32
# NEVER use 'changeme' or similar weak passwords in any environment
POSTGRES_PASSWORD=__REPLACE_WITH_SECURE_PASSWORD__

# =============================================================================
# Consul Service Discovery Configuration
# =============================================================================
# Consul agent connection for service registration and discovery.
# CONSUL_HOST=omninode-bridge-consul
# CONSUL_PORT=8500
# CONSUL_SCHEME=http

# =============================================================================
# Vault Secret Management Configuration
# =============================================================================
# HashiCorp Vault connection for secure secret retrieval.
# VAULT_ADDR=http://omninode-bridge-vault:8200

# REQUIRED - SECURITY: Must be set explicitly, no default value allowed
# ⚠️ CRITICAL: Replace this placeholder before ANY deployment!
# For development: Use Vault's root token from initial setup
# For production: Use a properly scoped Vault token with minimal permissions
# NEVER commit real Vault tokens to version control
VAULT_TOKEN=__REPLACE_WITH_VAULT_TOKEN__

# =============================================================================
# Redis / Valkey Cache Configuration
# =============================================================================
# Redis connection for caching and pub/sub operations.
# REDIS_HOST=omninode-bridge-redis
# REDIS_PORT=6379

# REQUIRED - SECURITY: Must be set explicitly, no default value allowed
# ⚠️ CRITICAL: Replace this placeholder before ANY deployment!
# Generate a secure password: openssl rand -base64 32
# NEVER use 'changeme' or similar weak passwords in any environment
REDIS_PASSWORD=__REPLACE_WITH_SECURE_PASSWORD__

# =============================================================================
# ONEX Runtime Configuration
# =============================================================================
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# ONEX_LOG_LEVEL=INFO

# Environment name: development, staging, production
# ONEX_ENVIRONMENT=development

# HTTP port for health check server inside the container.
# This is the internal port the runtime listens on (default: 8085).
# Note: RUNTIME_MAIN_PORT below maps this to the host.
# ONEX_HTTP_PORT=8085

# Host address to bind the health server to.
# Use 0.0.0.0 for Docker containers (allows external health checks).
# Use 127.0.0.1 for local development (restricts to localhost only).
# RUNTIME_BIND_HOST=0.0.0.0

# =============================================================================
# Main Runtime Service Configuration
# =============================================================================
# Host port mapping for the main runtime service
# RUNTIME_MAIN_PORT=8085

# Kafka topics for main runtime
# ONEX_INPUT_TOPIC=requests
# ONEX_OUTPUT_TOPIC=responses

# Consumer group ID for main runtime
# ONEX_GROUP_ID=onex-runtime-main

# =============================================================================
# Effects Runtime Service Configuration
# =============================================================================
# Host port mapping for the effects runtime service
# RUNTIME_EFFECTS_PORT=8086

# Kafka topics for effects runtime
# ONEX_EFFECTS_INPUT_TOPIC=effect-requests
# ONEX_EFFECTS_OUTPUT_TOPIC=effect-responses

# Consumer group ID for effects runtime
# ONEX_EFFECTS_GROUP_ID=onex-runtime-effects

# =============================================================================
# Worker Runtime Service Configuration
# =============================================================================
# Number of worker replicas (for horizontal scaling)
# WORKER_REPLICAS=2

# Kafka topics for worker runtime
# ONEX_WORKER_INPUT_TOPIC=worker-requests
# ONEX_WORKER_OUTPUT_TOPIC=worker-responses

# Consumer group ID for workers
# ONEX_WORKER_GROUP_ID=onex-runtime-workers

# =============================================================================
# ONEX Handler Configuration (Optional)
# =============================================================================
# HTTP handler settings for request/response processing.
# ONEX_HTTP_TIMEOUT=30.0                 # Range: 0.1-3600.0 seconds (default: 30.0)
# ONEX_HTTP_MAX_REQUEST_SIZE=10485760    # Range: 1-1073741824 bytes (default: 10MB)
# ONEX_HTTP_MAX_RESPONSE_SIZE=52428800   # Range: 1-1073741824 bytes (default: 50MB)

# Database handler settings for query execution.
# ONEX_DB_POOL_SIZE=5                    # Range: 1-100 (default: 5)
# ONEX_DB_TIMEOUT=30.0                   # Range: 0.1-3600.0 seconds (default: 30.0)

# =============================================================================
# Circuit Breaker Configuration (Optional)
# =============================================================================
# Global circuit breaker settings for external service integrations.
# These defaults can be overridden per-service (e.g., KAFKA_CIRCUIT_BREAKER_*).
#
# Maximum consecutive failures before opening circuit (default: 5)
# When reached, the circuit opens and fails fast without attempting calls.
# ONEX_CB_THRESHOLD=5                    # Range: 1+ (minimum 1)

# Seconds before automatic transition from OPEN to HALF_OPEN (default: 60.0)
# After this timeout, the circuit allows a test request through.
# ONEX_CB_RESET_TIMEOUT=60.0             # Range: 0+ seconds

# =============================================================================
# Idempotency Store Configuration (Optional)
# =============================================================================
# Settings for the idempotency store used to prevent duplicate processing.
# The store tracks processed event IDs with automatic cleanup of old records.
#
# Time-to-live for idempotency records in seconds (default: 86400 = 24 hours)
# Records older than this are eligible for cleanup.
# ONEX_IDEMPOTENCY_TTL_SECONDS=86400     # Range: 60-2592000 (1 min to 30 days)

# Interval between cleanup runs in seconds (default: 3600 = 1 hour)
# Controls how frequently the background cleanup task runs.
# ONEX_IDEMPOTENCY_CLEANUP_INTERVAL=3600 # Range: 60-86400 (1 min to 24 hours)

# Number of records to delete per cleanup batch (default: 10000)
# Limits memory and transaction size during cleanup operations.
# ONEX_IDEMPOTENCY_BATCH_SIZE=10000      # Range: 100-100000

# Connection pool settings for idempotency operations.
# ONEX_IDEMPOTENCY_POOL_MIN_SIZE=1       # Range: 1-100 (min connections)
# ONEX_IDEMPOTENCY_POOL_MAX_SIZE=5       # Range: 1-100 (max connections)
# ONEX_IDEMPOTENCY_COMMAND_TIMEOUT=30.0  # Range: 1.0-300.0 seconds

# Clock skew tolerance in seconds (default: 60)
# Buffer added to TTL during cleanup to prevent premature deletion.
# ONEX_IDEMPOTENCY_CLOCK_SKEW_TOLERANCE=60  # Range: 0-3600 (0 to 1 hour)

# Maximum cleanup iterations (default: 100)
# ONEX_IDEMPOTENCY_CLEANUP_MAX_ITERATIONS=100  # Range: 1-1000

# =============================================================================
# Compute Registry Configuration (Optional)
# =============================================================================
# Semver LRU cache size for plugin version resolution.
# Increase for large deployments with many unique version strings.
# ONEX_COMPUTE_REGISTRY_CACHE_SIZE=128   # Range: 1-10000 (default: 128)
#
# -----------------------------------------------------------------------------
# DEPRECATED: COMPUTE_REGISTRY_CACHE_SIZE
# -----------------------------------------------------------------------------
# Status: DEPRECATED - Will be removed in v2.0.0
# Replacement: ONEX_COMPUTE_REGISTRY_CACHE_SIZE
# Migration: Rename COMPUTE_REGISTRY_CACHE_SIZE to ONEX_COMPUTE_REGISTRY_CACHE_SIZE
# Legacy name (DO NOT USE for new deployments):
# COMPUTE_REGISTRY_CACHE_SIZE=128
# -----------------------------------------------------------------------------

# =============================================================================
# OpenTelemetry Observability Configuration (Optional)
# =============================================================================
# OTLP exporter endpoint for traces and metrics
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# Service name for tracing identification
# OTEL_SERVICE_NAME=omnibase-infra-runtime

# Exporter types: otlp, console, none
# OTEL_TRACES_EXPORTER=otlp
# OTEL_METRICS_EXPORTER=otlp
