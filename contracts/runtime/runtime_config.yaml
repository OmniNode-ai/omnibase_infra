# SPDX-License-Identifier: MIT
# Copyright (c) 2025 OmniNode Team
#
# ONEX Runtime Configuration Contract
#
# This file configures the ONEX runtime kernel. It is loaded by kernel.py
# during bootstrap to configure the RuntimeHostProcess.
#
# =============================================================================
# CONFIGURATION PRIORITY:
# =============================================================================
# When this file exists, contract values are loaded and used directly.
# Only ONEX_ENVIRONMENT and ONEX_EVENT_BUS_TYPE override contract values
# at runtime (applied by bootstrap after config loading).
#
# When this file does NOT exist, the kernel falls back to env vars and
# model defaults: ONEX_INPUT_TOPIC, ONEX_OUTPUT_TOPIC, ONEX_GROUP_ID.
#
# =============================================================================
# ENVIRONMENT VARIABLES:
# =============================================================================
# Runtime overrides (always applied, even when this file is present):
#   ONEX_ENVIRONMENT    - Override event_bus.environment
#   ONEX_EVENT_BUS_TYPE - Override event_bus.type ("inmemory" or "kafka")
#                         Use "inmemory" for CI/testing without Kafka
#   ONEX_LOG_LEVEL      - Logging level (used directly by kernel, not
#                         through this contract)
#
# Fallback defaults (only when this file is absent):
#   ONEX_INPUT_TOPIC    - Default input_topic
#   ONEX_OUTPUT_TOPIC   - Default output_topic
#   ONEX_GROUP_ID       - Default group_id
#
# =============================================================================
# FIELD STATUS LEGEND:
# =============================================================================
#   [ACTIVE]   - Currently used by kernel.py
#   [RESERVED] - Defined for forward compatibility, not yet implemented
#
# =============================================================================
# Contract metadata [RESERVED - for versioning and discovery]
contract_version: "1.0.0"
name: "runtime_config"
description: "Configuration for ONEX runtime kernel"
# Topic configuration [ACTIVE - used by RuntimeHostProcess]
# These values take precedence when this file is loaded. ONEX_INPUT_TOPIC,
# ONEX_OUTPUT_TOPIC, ONEX_GROUP_ID are only used as fallback defaults when
# this config file is absent (see load_runtime_config in service_kernel.py).
input_topic: "onex.evt.platform.node-introspection.v1"
output_topic: "onex.evt.platform.registration-completed.v1"
group_id: "onex-runtime-e2e"
# Event bus configuration [ACTIVE - used by ServiceKernel]
# The kernel uses this configuration to wire the event bus via the registry.
event_bus:
  # [ACTIVE] type selects the event bus implementation
  # - "kafka": Production event bus using Redpanda/Kafka (default)
  # - "inmemory": In-memory event bus for testing/development
  type: "kafka"
  # [ACTIVE] environment is used for topic prefixing and consumer group naming
  # Can be overridden by ONEX_ENVIRONMENT env var
  environment: "local"
  # [ACTIVE] max_history configures event history buffer size (inmemory only)
  max_history: 1000
  # [ACTIVE] circuit_breaker_threshold configures fault tolerance behavior
  circuit_breaker_threshold: 5
# Contract registry configuration [ACTIVE - used by ServiceKernel]
# The contract registry manages contract staleness checks and persistence.
contract_registry:
  # [ACTIVE] enabled controls whether the contract registry is active
  # When true, the kernel wires contract persistence and staleness checking
  enabled: true
  # [ACTIVE] tick_interval_seconds controls periodic staleness check frequency
  # The registry will check for stale contracts at this interval (in seconds)
  tick_interval_seconds: 60
# Handler configuration [RESERVED - not currently used]
# Future: Will be used for dynamic protocol loading and configuration
handlers:
  # Handlers are wired via the wiring module
  # This section can be extended for handler-specific config
  enabled:
    - http
    - db
# Logging configuration [RESERVED - not currently used]
# Note: kernel.py currently uses ONEX_LOG_LEVEL env var directly
# Future: Will support contract-driven logging configuration
logging:
  level: "INFO"
  format: "%(asctime)s [%(levelname)s] %(name)s: %(message)s"
# Shutdown configuration [RESERVED - not currently used]
# Future: Will configure graceful shutdown timeout
shutdown:
  grace_period_seconds: 30
